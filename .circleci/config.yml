version: 2
jobs:
  build:
    docker:
      - image: golang:1.13-alpine
    working_directory: /go/src/github.com/andodevel/clock_server
    steps:
      - checkout
      - run: 
          name: "Install builing tools"
          command: apk --no-cache add bash ncurses make git gcc libtool musl-dev upx
      - run: 
          name: "Run make ci target"
          command: make ci
      - run:
          name: Login into Heroku Docker Repository
          command: |
            docker login --username=$HEROKU_LOGIN --password=$HEROKU_API_KEY registry.heroku.com
      - run:
          name: Deploy Heroku Docker Container
          command: |
            heroku container:push web --app=clock-server-dragonfly
            heroku container:release web --app=clock-server-dragonfly